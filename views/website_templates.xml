<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- TEMPLATE FOR UNIVERSITY LIST -->
    <template id="website_universities" name="Website Universities">
        <t t-call="website.layout">
            <!-- Hero Section -->
            <section class="py-5" style="background: linear-gradient(135deg, #f5f7fa 0%, #e9ecef 50%, #dee2e6 100%);">
                <div class="container text-center py-5">
                    <h1 class="display-3 fw-bold mb-4" style="color: #2c3e50;">Our Universities</h1>
                    <p class="lead mb-4" style="color: #495057;">Discover our network of educational institutions</p>
                    <div class="mt-4">
                        <div class="row justify-content-center">
                            <div class="col-md-6">
                                <form class="d-flex" action="/universities" method="GET">
                                    <input type="text" name="search" 
                                           class="form-control form-control-lg me-2" 
                                           placeholder="Search universities..." 
                                           style="border-radius: 30px;"
                                           t-att-value="search if search else ''"/>
                                    <button class="btn btn-lg px-4" type="submit"
                                            style="background: linear-gradient(to right, #7da2e8, #5478c7); 
                                                   color: white; 
                                                   border: none; 
                                                   border-radius: 30px;">
                                        <i class="fa fa-search"></i>
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Universities Grid -->
            <section class="py-5" style="background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);">
                <div class="container">
                    <div class="row g-3">
                        <t t-foreach="universities" t-as="uni">
                            <div class="col-xl-3 col-lg-4 col-md-6">
                                <div class="card h-100 border-0 shadow-sm" 
                                     style="border-radius: 12px; transition: all 0.3s ease;"
                                     onmouseover="this.style.transform='translateY(-5px)'"
                                     onmouseout="this.style.transform='translateY(0)'">
                                    <!-- Image Section -->
                                    <div style="height: 160px; position: relative; overflow: hidden; border-radius: 12px 12px 0 0;">
                                        <t t-if="uni.image_1920">
                                            <img t-att-src="image_data_uri(uni.image_1920)" 
                                                 class="w-100 h-100"
                                                 style="object-fit: cover; object-position: center;"
                                                 alt="University"/>
                                        </t>
                                        <t t-else="">
                                            <img src="/Universidad/static/src/img/default_university.png"
                                                 class="w-100 h-100"
                                                 style="object-fit: cover; object-position: center;"
                                                 alt="Default University"/>
                                        </t>
                                        <!-- Overlay -->
                                        <div class="position-absolute bottom-0 start-0 w-100 p-2"
                                             style="background: linear-gradient(transparent, rgba(0,0,0,0.8));">
                                            <h6 class="fw-bold text-white mb-0">
                                                <t t-esc="uni.name"/>
                                            </h6>
                                        </div>
                                    </div>

                                    <!-- Content -->
                                    <div class="card-body p-3">
                                        <!-- Stats Grid -->
                                        <div class="row g-2 mb-3">
                                            <div class="col-4">
                                                <div class="p-2 rounded-3 text-center bg-light">
                                                    <div class="h6 mb-0 text-primary">
                                                        <t t-esc="len(uni.professor_ids)"/>
                                                    </div>
                                                    <small class="text-muted" style="font-size: 0.7rem;">Professors</small>
                                                </div>
                                            </div>
                                            <div class="col-4">
                                                <div class="p-2 rounded-3 text-center bg-light">
                                                    <div class="h6 mb-0 text-success">
                                                        <t t-esc="len(uni.student_ids)"/>
                                                    </div>
                                                    <small class="text-muted" style="font-size: 0.7rem;">Students</small>
                                                </div>
                                            </div>
                                            <div class="col-4">
                                                <div class="p-2 rounded-3 text-center bg-light">
                                                    <div class="h6 mb-0 text-info">
                                                        <t t-esc="len(uni.department_ids)"/>
                                                    </div>
                                                    <small class="text-muted" style="font-size: 0.7rem;">Depts.</small>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Actions -->
                                        <a t-attf-href="/professors/#{uni.id}" 
                                           class="btn btn-sm w-100"
                                           style="background: linear-gradient(to right, #7da2e8, #5478c7); 
                                                  color: white; 
                                                  border: none; 
                                                  border-radius: 20px;
                                                  font-size: 0.8rem;">
                                            <i class="fa fa-users me-1"></i> View Professors
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </div>
                </div>
            </section>
        </t>
    </template>

    <!-- TEMPLATE FOR UNIVERSITY PROFESSORS -->
    <template id="website_professors" name="Website Professors">
        <t t-call="website.layout">
            <!-- Hero Section -->
            <section class="py-5" style="background: linear-gradient(135deg, #f5f7fa 0%, #e9ecef 50%, #dee2e6 100%);">
                <div class="container text-center py-5">
                    <h1 class="display-3 fw-bold mb-4" style="color: #2c3e50;" t-translation="on">
                        Professors at <span class="text-primary"><t t-esc="university.name"/></span>
                    </h1>
                    <p class="lead mb-4" style="color: #495057;" t-translation="on">
                        Meet our experienced faculty members
                    </p>
                    <div class="mt-4">
                        <div class="row justify-content-center">
                            <div class="col-md-6">
                                <form class="d-flex" action="/professors" method="GET">
                                    <input type="text" name="search" class="form-control form-control-lg me-2" 
                                           placeholder="Search professors..." 
                                           style="border-radius: 30px;"/>
                                    <button class="btn btn-lg px-4" type="submit"
                                            style="background: linear-gradient(to right, #7da2e8, #5478c7); 
                                                   color: white; 
                                                   border: none; 
                                                   border-radius: 30px;">
                                        <i class="fa fa-search"></i>
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Professors Grid -->
            <section class="py-5" style="background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);">
                <div class="container">
                    <div class="row g-4">
                        <t t-foreach="professors" t-as="professor">
                            <div class="col-lg-4 col-md-6">
                                <div class="card h-100 border-0 shadow-sm" 
                                     style="border-radius: 15px; transition: transform 0.3s ease;">
                                    <!-- Image Section -->
                                    <div style="height: 200px; position: relative; overflow: hidden; border-radius: 15px 15px 0 0;">
                                        <t t-if="professor.image_1920">
                                            <img t-att-src="image_data_uri(professor.image_1920)" 
                                                 class="w-100 h-100"
                                                 style="object-fit: cover; object-position: center;"
                                                 alt="Professor"/>
                                        </t>
                                        <t t-else="">
                                            <img src="/Universidad/static/src/img/default_professor.png"
                                                 class="w-100 h-100"
                                                 style="object-fit: cover; object-position: center;"
                                                 alt="Default Professor"/>
                                        </t>
                                        <!-- Overlay -->
                                        <div class="position-absolute bottom-0 start-0 w-100 p-3"
                                             style="background: linear-gradient(transparent, rgba(0,0,0,0.7));">
                                            <h4 class="card-title fw-bold text-white mb-0">
                                                <t t-esc="professor.name"/>
                                            </h4>
                                        </div>
                                    </div>

                                    <!-- Content -->
                                    <div class="card-body p-4">
                                        <!-- Info Grid -->
                                        <div class="mb-4">
                                            <div class="d-flex align-items-center mb-3">
                                                <i class="fa fa-university text-primary me-2"></i>
                                                <span class="text-muted" t-translation="on">Department:</span>
                                                <span class="ms-2"><t t-esc="professor.department_id.name"/></span>
                                            </div>
                                            <div class="d-flex align-items-center mb-3">
                                                <i class="fa fa-book text-info me-2"></i>
                                                <span class="text-muted" t-translation="on">Subjects:</span>
                                                <span class="ms-2"><t t-esc="len(professor.subject_ids)"/></span>
                                            </div>
                                            <div class="small text-muted ps-4">
                                                <t t-foreach="professor.subject_ids" t-as="subject">
                                                    <div><t t-esc="subject.name"/></div>
                                                </t>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </div>
                </div>
            </section>
        </t>
    </template>

    <!-- TEMPLATE FOR ALL PROFESSORS -->
    <template id="website_all_professors" name="All Professors">
        <t t-call="website.layout">
            <!-- Hero Section -->
            <section class="py-5" style="background: linear-gradient(135deg, #f5f7fa 0%, #e9ecef 50%, #dee2e6 100%);">
                <div class="container text-center py-5">
                    <h1 class="display-3 fw-bold mb-4" style="color: #2c3e50;">Professors by University</h1>
                    <p class="lead mb-4" style="color: #495057;">Meet our expert faculty members across all universities</p>
                </div>
            </section>

            <!-- Universities Section -->
            <section class="py-5" style="background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);">
                <div class="container">
                    <t t-foreach="universities.items()" t-as="uni_profs">
                        <div class="mb-5">
                            <!-- University Header -->
                            <div class="d-flex align-items-center mb-4 p-3 rounded-4" 
                                 t-attf-style="background-color: #{university_colors[uni_profs[0].id]['bg']};">
                                <div class="me-auto">
                                    <h2 class="h3 mb-0" style="color: #2c3e50;">
                                        <t t-esc="uni_profs[0].name"/>
                                    </h2>
                                    <p class="mb-0 text-muted">
                                        <t t-esc="len(uni_profs[1])"/> Professors
                                    </p>
                                </div>
                                <div class="border-start ps-4 ms-4" 
                                     t-attf-style="border-color: #{university_colors[uni_profs[0].id]['border']} !important;">
                                    <div class="text-center">
                                        <div class="h4 mb-0" style="color: #2c3e50;">
                                            <t t-esc="len(uni_profs[1])"/>
                                        </div>
                                        <small class="text-muted">Total</small>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Professors Grid -->
                            <div class="row g-4">
                                <t t-foreach="uni_profs[1]" t-as="prof">
                                    <div class="col-xl-3 col-lg-4 col-md-6">
                                        <div class="card h-100 border-0 shadow-sm" 
                                             style="border-radius: 15px; transition: all 0.3s ease;"
                                             onmouseover="this.style.transform='translateY(-5px)'"
                                             onmouseout="this.style.transform='translateY(0)'">
                                            <!-- Profile Image -->
                                            <div style="height: 200px; position: relative; overflow: hidden; border-radius: 15px 15px 0 0;">
                                                <t t-if="prof.image_1920">
                                                    <img t-att-src="image_data_uri(prof.image_1920)"
                                                         class="w-100 h-100"
                                                         style="object-fit: cover;"
                                                         alt="Professor"/>
                                                </t>
                                                <t t-else="">
                                                    <img src="/Universidad/static/src/img/default_professor.png"
                                                         class="w-100 h-100"
                                                         style="object-fit: cover;"
                                                         alt="Default Professor"/>
                                                </t>
                                                <!-- Gradient Overlay -->
                                                <div class="position-absolute bottom-0 start-0 w-100 p-3"
                                                     style="background: linear-gradient(transparent, rgba(0,0,0,0.7));">
                                                    <h5 class="card-title fw-bold text-white mb-0">
                                                        <t t-esc="prof.name"/>
                                                    </h5>
                                                </div>
                                            </div>
                                            
                                            <!-- Content -->
                                            <div class="card-body p-4">
                                                <div class="d-flex align-items-center mb-3">
                                                    <i class="fa fa-building text-primary me-2"></i>
                                                    <span class="text-muted">Department:</span>
                                                    <span class="ms-2"><t t-esc="prof.department_id.name"/></span>
                                                </div>
                                                <div class="d-flex align-items-center">
                                                    <i class="fa fa-book text-info me-2"></i>
                                                    <span class="text-muted">Subjects:</span>
                                                    <span class="ms-2"><t t-esc="len(prof.subject_ids)"/></span>
                                                </div>
                                                <!-- Subjects List -->
                                                <div class="mt-3">
                                                    <div class="d-flex flex-wrap gap-2">
                                                        <t t-foreach="prof.subject_ids" t-as="subject">
                                                            <span class="badge bg-light text-dark px-2 py-1">
                                                                <t t-esc="subject.name"/>
                                                            </span>
                                                        </t>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </t>
                            </div>
                        </div>
                    </t>
                </div>
            </section>
        </t>
    </template>

    <!-- TEMPLATE FOR STUDENTS -->
    <template id="website_students" name="Website Students">
        <t t-call="website.layout">
            <!-- Hero Section -->
            <section class="py-5" style="background: linear-gradient(135deg, #f5f7fa 0%, #e9ecef 50%, #dee2e6 100%);">
                <div class="container text-center py-5">
                    <h1 class="display-3 fw-bold mb-4" style="color: #2c3e50;" t-translation="on">Our Students</h1>
                    <p class="lead mb-4" style="color: #495057;" t-translation="on">Meet our talented student community</p>
                    <div class="mt-4">
                        <div class="row justify-content-center">
                            <div class="col-md-6">
                                <form action="/students" method="GET" class="mb-4">
                                    <!-- Buscador -->
                                    <div class="input-group mb-3">
                                        <input type="text" name="search" 
                                               class="form-control" 
                                               placeholder="Search by name..." 
                                               t-att-value="search if search else ''"
                                               style="border-radius: 30px 0 0 30px;"/>
                                        <button class="btn px-4" type="submit"
                                                style="background: linear-gradient(to right, #7da2e8, #5478c7); 
                                                       color: white; 
                                                       border: none;
                                                       border-radius: 0 30px 30px 0;">
                                            <i class="fa fa-search"></i>
                                        </button>
                                    </div>
                                    
                                    <!-- Selector de Universidad -->
                                    <select name="university_id" 
                                            class="form-select" 
                                            style="border-radius: 30px;"
                                            onchange="this.form.submit()">
                                        <option value="">All Universities</option>
                                        <t t-foreach="universities" t-as="uni">
                                            <option t-att-value="uni.id" 
                                                    t-att-selected="str(uni.id) == request.params.get('university_id')">
                                                <t t-esc="uni.name"/>
                                            </option>
                                        </t>
                                    </select>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Students Grid -->
            <section class="py-5" style="background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);">
                <div class="container">
                    <div class="row g-3">
                        <t t-foreach="students" t-as="student">
                            <div class="col-xl-3 col-lg-4 col-md-6">
                                <div class="card h-100 border-0 shadow-sm" 
                                     style="border-radius: 12px; transition: transform 0.3s ease;">
                                    <!-- Image Section -->
                                    <div style="height: 160px; position: relative; overflow: hidden; border-radius: 12px 12px 0 0;">
                                        <t t-if="student.image_1920">
                                            <img t-att-src="image_data_uri(student.image_1920)" 
                                                 class="w-100 h-100"
                                                 style="object-fit: cover; object-position: center;"
                                                 alt="Student"/>
                                        </t>
                                        <t t-else="">
                                            <img src="/Universidad/static/src/img/default_student.png"
                                                 class="w-100 h-100"
                                                 style="object-fit: cover; object-position: center;"
                                                 alt="Default Student"/>
                                        </t>
                                        <!-- Overlay -->
                                        <div class="position-absolute bottom-0 start-0 w-100 p-2"
                                             style="background: linear-gradient(transparent, rgba(0,0,0,0.7));">
                                            <h6 class="fw-bold text-white mb-0 fs-6">
                                                <t t-esc="student.name"/>
                                            </h6>
                                        </div>
                                    </div>

                                    <!-- Content -->
                                    <div class="card-body p-3">
                                        <!-- Info Grid -->
                                        <div class="mb-2">
                                            <div class="d-flex align-items-center mb-2">
                                                <i class="fa fa-university text-primary me-2 small"></i>
                                                <span class="text-muted" style="font-size: 0.8rem;">University:</span>
                                                <span class="ms-1 fw-bold" style="font-size: 0.8rem;"><t t-esc="student.university_id.name"/></span>
                                            </div>
                                            <div class="d-flex align-items-center mb-2">
                                                <i class="fa fa-user text-success me-2 small"></i>
                                                <span class="text-muted" style="font-size: 0.8rem;">Tutor:</span>
                                                <span class="ms-1" style="font-size: 0.7rem;"><t t-esc="student.tutor_id.name"/></span>
                                            </div>
                                            <div class="d-flex flex-column">
                                                <div class="d-flex align-items-center mb-1">
                                                    <i class="fa fa-book text-info me-2 small"></i>
                                                    <span class="text-muted" style="font-size: 0.8rem;">Enrollments:</span>
                                                    <span class="ms-1" style="font-size: 0.7rem;"><t t-esc="len(student.enrollment_ids)"/></span>
                                                </div>
                                                <div class="ps-4">
                                                    <t t-foreach="student.enrollment_ids" t-as="enrollment">
                                                        <div class="text-muted" style="font-size: 0.65rem;">
                                                            <t t-esc="enrollment.subject_id.name"/>
                                                        </div>
                                                    </t>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </div>
                </div>
            </section>
        </t>
    </template>

    <!-- PORTAL MY HOME INHERIT BLOCK -->
    <template id="portal_my_home_inherit" inherit_id="portal.portal_my_home" name="Portal - Grades Link">
        <xpath expr="//div[contains(@class, 'o_portal_my_home')]" position="inside">
            <t t-if="request.env['university.student'].sudo().search([('user_id', '=', request.env.user.id)], limit=1)">
                <div class="card mb-3">
                    <div class="card-body">
                        <h5 class="card-title">Check my grades</h5>
                        <a href="/my/grades" class="btn btn-primary">View my grades</a>
                    </div>
                </div>
            </t>
        </xpath>
    </template>

    <!-- PORTAL GRADES VIEW -->
    <template id="portal_grades" name="Portal - My Grades">
        <t t-call="portal.portal_layout">
            <div class="container my-5">
                <!-- Filters -->
                <div class="row mb-4">
                    <div class="col-12">
                        <form class="d-flex align-items-center gap-3" method="GET">
                            <!-- University Filter -->
                            <div class="d-flex align-items-center">
                                <label class="me-2">University:</label>
                                <select name="university_id" class="form-control" onchange="this.form.submit()">
                                    <option value="">All</option>
                                    <t t-foreach="universities" t-as="uni">
                                        <option t-att-value="uni.id" 
                                                t-att-selected="uni.id == current_university">
                                            <t t-esc="uni.name"/>
                                        </option>
                                    </t>
                                </select>
                            </div>
                            <!-- Status Filter -->
                            <div class="d-flex align-items-center">
                                <label class="me-2">Status:</label>
                                <select name="grade_filter" class="form-control" onchange="this.form.submit()">
                                    <option value="all" t-att-selected="current_filter == 'all'">All</option>
                                    <option value="passed" t-att-selected="current_filter == 'passed'">Passed</option>
                                    <option value="failed" t-att-selected="current_filter == 'failed'">Failed</option>
                                </select>
                            </div>
                        </form>
                    </div>
                </div>
                
                <h2>
                    <t t-if="is_admin">
                        All Grades (Admin View)
                    </t>
                    <t t-else="">
                        My Grades
                    </t>
                </h2>
                
                <!-- Grades Table -->
                <table class="table table-bordered mt-3">
                    <thead>
                        <tr>
                            <t t-if="is_admin">
                                <th>Student</th>
                            </t>
                            <th>Subject</th>
                            <th>Professor</th>
                            <th>University</th>
                            <th>Date</th>
                            <th>Grade</th>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-foreach="grades" t-as="grade">
                            <tr>
                                <t t-if="is_admin">
                                    <td><t t-esc="grade.student_id.name"/></td>
                                </t>
                                <td><t t-esc="grade.enrollment_id.subject_id.name"/></td>
                                <td><t t-esc="grade.enrollment_id.professor_id.name"/></td>
                                <td><t t-esc="grade.enrollment_id.university_id.name"/></td>
                                <td><t t-esc="grade.enrollment_id.date.strftime('%Y-%m-%d')"/></td>
                                <td t-attf-class="text-center #{grade.grade >= 5.0 and 'bg-success-subtle' or 'bg-danger-subtle'}">
                                    <strong><t t-esc="grade.grade"/></strong>
                                </td>
                            </tr>
                        </t>
                    </tbody>
                </table>
                
                <t t-if="is_admin">
                    <div class="alert alert-info mt-3">
                        <i class="fa fa-info-circle"></i> You are viewing all grades as administrator
                    </div>
                </t>
            </div>
        </t>
    </template>

    <!-- LANGUAGE SELECTOR -->
    <template id="language_selector" inherit_id="website.layout">
        <xpath expr="//header//ul[contains(@class, 'navbar-nav')]" position="inside">
            <li class="nav-item d-flex align-items-center px-2">
                <t t-set="current_lang" t-value="request.session.get('frontend_lang', 'en_US')"/>
                <a t-att-href="'/change_lang/es_ES?r=' + request.httprequest.url"
                   class="btn btn-sm me-2"
                   t-attf-style="background-color: #{current_lang == 'es_ES' and '#5478c7' or '#e9ecef'}; 
                                color: #{current_lang == 'es_ES' and 'white' or 'black'};">
                    <i class="fa fa-globe me-1"></i> ES
                </a>
                <a t-att-href="'/change_lang/en_US?r=' + request.httprequest.url"
                   class="btn btn-sm"
                   t-attf-style="background-color: #{current_lang == 'en_US' and '#5478c7' or '#e9ecef'}; 
                                color: #{current_lang == 'en_US' and 'white' or 'black'};">
                    <i class="fa fa-globe me-1"></i> EN
                </a>
            </li>
        </xpath>
    </template>

</odoo>

